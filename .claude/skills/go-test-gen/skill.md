# go-test-gen - Go å•å…ƒæµ‹è¯•ç”Ÿæˆå™¨

æ™ºèƒ½åˆ†æ Go æºä»£ç å¹¶ç”Ÿæˆç¬¦åˆé¡¹ç›®è§„èŒƒçš„å•å…ƒæµ‹è¯•ã€åŸºå‡†æµ‹è¯•å’Œæµ‹è¯•è¾…åŠ©ä»£ç ã€‚

---

## Skill å…ƒä¿¡æ¯

- **åç§°**: go-test-gen
- **ç‰ˆæœ¬**: 1.0.0
- **é€‚ç”¨è¯­è¨€**: Go 1.24+
- **ä¾èµ–**: testify/assert, testify/require, testify/mock

---

## ä½¿ç”¨æ–¹å¼

```bash
# åŸºç¡€ç”¨æ³• - ä¸ºæŒ‡å®šæ–‡ä»¶ç”Ÿæˆæµ‹è¯•
/go-test-gen <source_file>

# åˆ†æè¦†ç›–ç‡å¹¶ç”Ÿæˆç¼ºå¤±çš„æµ‹è¯•
/go-test-gen --coverage <source_file>

# ç”ŸæˆåŸºå‡†æµ‹è¯•
/go-test-gen --benchmark <source_file>

# æ›´æ–°å·²æœ‰æµ‹è¯•ï¼ˆè¡¥å……ç¼ºå¤±çš„æµ‹è¯•ç”¨ä¾‹ï¼‰
/go-test-gen --update <test_file>

# ç”Ÿæˆ Mock æ¥å£å®ç°
/go-test-gen --mock <interface_name> <source_file>

# æ‰¹é‡ç”Ÿæˆæ•´ä¸ªåŒ…çš„æµ‹è¯•
/go-test-gen --package <package_path>
```

---

## æ ¸å¿ƒåŠŸèƒ½

### 1. æ™ºèƒ½ä»£ç åˆ†æ
- è§£æå‡½æ•°ç­¾åã€å‚æ•°ã€è¿”å›å€¼
- è¯†åˆ«é”™è¯¯å¤„ç†è·¯å¾„ï¼ˆif err != nilï¼‰
- æ£€æµ‹è¾¹ç•Œæ¡ä»¶ï¼ˆnilã€ç©ºåˆ‡ç‰‡ã€é›¶å€¼ï¼‰
- åˆ†æä¾èµ–æ³¨å…¥ç‚¹ï¼ˆæ¥å£å‚æ•°ï¼‰
- è¯†åˆ«å¹¶å‘æ•æ„Ÿå‡½æ•°ï¼ˆsyncã€channelï¼‰

### 2. è‡ªåŠ¨ç”Ÿæˆæµ‹è¯•
- **è¡¨é©±åŠ¨æµ‹è¯•**: å¤šåœºæ™¯æµ‹è¯•ç»“æ„ï¼ˆ3+ åœºæ™¯æ—¶ä½¿ç”¨ï¼‰
- **ç®€å•æµ‹è¯•**: å•ä¸€åœºæ™¯å¿«é€Ÿæµ‹è¯•
- **å¹¶å‘æµ‹è¯•**: ç«æ€æ¡ä»¶æ£€æµ‹
- **è¾¹ç•Œæµ‹è¯•**: è‡ªåŠ¨æ·»åŠ  nilã€ç©ºå€¼ã€è¾¹ç•Œå€¼ç”¨ä¾‹
- **é”™è¯¯è·¯å¾„**: ä¸ºæ¯ä¸ªé”™è¯¯è¿”å›ç”Ÿæˆæµ‹è¯•

### 3. é¡¹ç›®è§„èŒƒéµå¾ª
è‡ªåŠ¨è¯»å–å¹¶åº”ç”¨é¡¹ç›®é…ç½®ï¼š
- `.golangci.yml` â†’ è¯†åˆ«å¯ç”¨çš„ linters
- `go.mod` â†’ æ£€æµ‹ Go ç‰ˆæœ¬å’Œä¾èµ–
- `CLAUDE.md` â†’ è¯»å–é¡¹ç›®æµ‹è¯•è§„èŒƒ

å¼ºåˆ¶åº”ç”¨çš„è§„èŒƒï¼š
- âœ… AAA æ¨¡å¼ï¼ˆArrange-Act-Assertï¼‰
- âœ… testify æ–­è¨€ï¼ˆassert/requireï¼‰
- âœ… å¹¶è¡Œæµ‹è¯•ï¼ˆt.Parallel()ï¼‰
- âœ… æµ‹è¯•è¾…åŠ©å‡½æ•°ï¼ˆt.Helper()ï¼‰
- âœ… èµ„æºæ¸…ç†ï¼ˆt.Cleanup()ï¼‰
- âœ… æè¿°æ€§æµ‹è¯•åç§°ï¼ˆsnake_caseï¼‰

### 4. åŸºå‡†æµ‹è¯•ç”Ÿæˆ
è‡ªåŠ¨è¯†åˆ«æ€§èƒ½æ•æ„Ÿå‡½æ•°å¹¶ç”Ÿæˆï¼š
- åŸºç¡€åŸºå‡†æµ‹è¯•ï¼ˆb.ReportAllocs()ï¼‰
- å¹¶è¡ŒåŸºå‡†æµ‹è¯•ï¼ˆb.RunParallel()ï¼‰

### 5. Mock ä»£ç ç”Ÿæˆ
ä¸ºæ¥å£ç”Ÿæˆ testify/mock å®ç°ï¼ŒåŒ…å«ï¼š
- Mock ç»“æ„ä½“å’Œæ–¹æ³•å®ç°
- æµ‹è¯•è¾…åŠ©å‡½æ•°

### 6. è¦†ç›–ç‡é©±åŠ¨
- è¿è¡Œ `go test -coverprofile`
- è§£æè¦†ç›–ç‡æŠ¥å‘Š
- è¯†åˆ«æœªè¦†ç›–çš„å‡½æ•°å’Œåˆ†æ”¯
- ç”Ÿæˆé’ˆå¯¹æ€§çš„æµ‹è¯•ç”¨ä¾‹

---
 
## å·¥ä½œæµç¨‹

```
1. è§£æå‘½ä»¤å‚æ•°
   â”œâ”€ ç¡®å®šæºæ–‡ä»¶è·¯å¾„å’Œç”Ÿæˆæ¨¡å¼
   â””â”€ è¯»å–é¡¹ç›®é…ç½®æ–‡ä»¶

2. åˆ†ææºä»£ç 
   â”œâ”€ ä½¿ç”¨ Go AST è§£ææºæ–‡ä»¶
   â”œâ”€ æå–å‡½æ•°ç­¾åå’Œæ–‡æ¡£æ³¨é‡Š
   â””â”€ åˆ†æå‡½æ•°å¤æ‚åº¦å’Œä¾èµ–

3. æ£€æŸ¥å·²æœ‰æµ‹è¯•
   â”œâ”€ æŸ¥æ‰¾ *_test.go æ–‡ä»¶
   â””â”€ è¯†åˆ«ç¼ºå¤±çš„æµ‹è¯•åœºæ™¯

4. ç”Ÿæˆæµ‹è¯•ä»£ç 
   â”œâ”€ é€‰æ‹©æµ‹è¯•æ¨¡æ¿ï¼ˆè¡¨é©±åŠ¨/ç®€å•/å¹¶å‘ï¼‰
   â”œâ”€ ç”Ÿæˆæµ‹è¯•ç”¨ä¾‹ç»“æ„
   â””â”€ åº”ç”¨é¡¹ç›®è§„èŒƒ

5. éªŒè¯å’Œä¼˜åŒ–
   â”œâ”€ æ ¼å¼åŒ–ç”Ÿæˆçš„ä»£ç ï¼ˆgofmtï¼‰
   â”œâ”€ è¿è¡Œ golangci-lint æ£€æŸ¥
   â””â”€ è¿è¡Œç”Ÿæˆçš„æµ‹è¯•å¹¶æŠ¥å‘Šè¦†ç›–ç‡

6. è¾“å‡ºç»“æœ
   â””â”€ æ˜¾ç¤ºç”Ÿæˆçš„æ–‡ä»¶ã€æµ‹è¯•è¿è¡Œç»“æœå’Œæ”¹è¿›å»ºè®®
```

---

## æµ‹è¯•æ¨¡æ¿ç»“æ„

### è¡¨é©±åŠ¨æµ‹è¯•
```go
func Test{FunctionName}(t *testing.T) {
    t.Parallel()

    tests := []struct {
        name    string
        // ... å‚æ•°å­—æ®µ
        want    {ReturnType}
        wantErr bool
    }{
        {name: "scenario_1", /* ... */ },
        {name: "scenario_2", /* ... */ },
    }

    for _, tt := range tests {
        t.Run(tt.name, func(t *testing.T) {
            t.Parallel()
            // Arrange, Act, Assert
        })
    }
}
```

### ç®€å•æµ‹è¯•
```go
func Test{FunctionName}_{Scenario}(t *testing.T) {
    t.Parallel()

    // Arrange
    // Act
    // Assert (ä½¿ç”¨ assert/require)
}
```

### å¹¶å‘å®‰å…¨æµ‹è¯•
```go
func Test{FunctionName}_ConcurrentSafe(t *testing.T) {
    t.Parallel()

    var wg sync.WaitGroup
    const goroutines = 100

    for i := 0; i < goroutines; i++ {
        wg.Add(1)
        go func(idx int) {
            defer wg.Done()
            // Act & Assert
        }(i)
    }

    wg.Wait()
}
```

### åŸºå‡†æµ‹è¯•
```go
func Benchmark{FunctionName}(b *testing.B) {
    // Arrange
    b.ReportAllocs()
    b.ResetTimer()

    for i := 0; i < b.N; i++ {
        {FunctionName}(/* params */)
    }
}

func Benchmark{FunctionName}_Parallel(b *testing.B) {
    b.ReportAllocs()
    b.ResetTimer()

    b.RunParallel(func(pb *testing.PB) {
        for pb.Next() {
            {FunctionName}(/* params */)
        }
    })
}
```

---

## æµ‹è¯•åœºæ™¯ç”Ÿæˆç­–ç•¥

æ ¹æ®å‡½æ•°ç­¾åè‡ªåŠ¨ç”Ÿæˆæµ‹è¯•åœºæ™¯ï¼š

| å‡½æ•°ç‰¹å¾ | ç”Ÿæˆåœºæ™¯ |
|---------|---------|
| æ¥å—æŒ‡é’ˆå‚æ•° | nil æŒ‡é’ˆã€æœ‰æ•ˆæŒ‡é’ˆ |
| æ¥å—åˆ‡ç‰‡å‚æ•° | nil åˆ‡ç‰‡ã€ç©ºåˆ‡ç‰‡ã€å•å…ƒç´ ã€å¤šå…ƒç´  |
| æ¥å—å­—ç¬¦ä¸²å‚æ•° | ç©ºå­—ç¬¦ä¸²ã€æ™®é€šå­—ç¬¦ä¸²ã€ç‰¹æ®Šå­—ç¬¦ |
| æ¥å—æ•°å€¼å‚æ•° | é›¶å€¼ã€è´Ÿæ•°ã€æ­£æ•°ã€è¾¹ç•Œå€¼ |
| è¿”å› error | æˆåŠŸåœºæ™¯ã€å„ç§é”™è¯¯åœºæ™¯ |
| è¿”å›å¤šå€¼ | éªŒè¯æ‰€æœ‰è¿”å›å€¼ |

**è¾¹ç•Œæ¡ä»¶è‡ªåŠ¨æ£€æµ‹**ï¼š
```go
// ç¤ºä¾‹ï¼šä¸ºè¿™ä¸ªå‡½æ•°ç”Ÿæˆè¾¹ç•Œæµ‹è¯•
func ProcessUsers(users []User, limit int) ([]User, error)

// è‡ªåŠ¨ç”Ÿæˆåœºæ™¯ï¼š
// - users == nil
// - users == []User{}
// - len(users) == 1
// - len(users) == limit
// - len(users) > limit
// - limit == 0, limit < 0, limit > len(users)
```

---

## é¡¹ç›®è§„èŒƒæ£€æµ‹

### è¯»å– .golangci.yml
è¯†åˆ«å¯ç”¨çš„ linters å¹¶è‡ªåŠ¨åº”ç”¨ï¼š
- `paralleltest` â†’ ç”Ÿæˆ `t.Parallel()`
- `testifylint` â†’ ä½¿ç”¨ `assert/require`
- `thelper` â†’ æ·»åŠ  `t.Helper()`
- `errcheck` â†’ æ£€æŸ¥æ‰€æœ‰ error

### è¯»å– CLAUDE.md
ä»é¡¹ç›®æ–‡æ¡£æå–æµ‹è¯•è§„èŒƒå¹¶è‡ªåŠ¨éµå¾ªã€‚

---

## ç”ŸæˆæŠ¥å‘Šæ ¼å¼

```
ğŸ“Š æµ‹è¯•ç”ŸæˆæŠ¥å‘Š
â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”â”

âœ… å·²ç”Ÿæˆæ–‡ä»¶: {file_path}

ğŸ“ ç”Ÿæˆçš„æµ‹è¯•å‡½æ•° ({count} ä¸ª):
  â€¢ TestFunction1_Scenario1
  â€¢ TestFunction1_Scenario2
  â€¢ TestFunction2

ğŸ§ª è¿è¡Œæµ‹è¯•:
  $ go test ./{package} -run TestFunction

ğŸ“ˆ è¦†ç›–ç‡å˜åŒ–:
  {file}: {before}% â†’ {after}% (+{delta}%)

ğŸ’¡ æ”¹è¿›å»ºè®®:
  â€¢ {suggestion_1}
  â€¢ {suggestion_2}

âš¡ ä¸‹ä¸€æ­¥:
  /go-test-gen --benchmark {file}
```

---

## ä½¿ç”¨æ³¨æ„äº‹é¡¹

### é™åˆ¶
1. **æ³›å‹å‡½æ•°** - éœ€æ‰‹åŠ¨è¡¥å……ç±»å‹å®ä¾‹åŒ–
2. **å¤æ‚æ¥å£ Mock** - å¯èƒ½éœ€è¦æ‰‹åŠ¨è°ƒæ•´
3. **ä»…æµ‹è¯•å¯¼å‡ºå‡½æ•°** - é»‘ç›’æµ‹è¯•ä¼˜å…ˆ
4. **å¹¶å‘æµ‹è¯•** - å¯èƒ½éœ€è¦è°ƒä¼˜ goroutine æ•°é‡

### æœ€ä½³å®è·µ
- âœ… å¢é‡ç”Ÿæˆï¼ˆæ–°å¢å‡½æ•°åç«‹å³ç”Ÿæˆæµ‹è¯•ï¼‰
- âœ… è¦†ç›–ç‡é©±åŠ¨ï¼ˆå®šæœŸè¿è¡Œ `--coverage` æ£€æŸ¥ï¼‰
- âœ… Review ç”Ÿæˆçš„ä»£ç ï¼ˆæµ‹è¯•æ˜¯èµ·ç‚¹ï¼Œä¸æ˜¯ç»ˆç‚¹ï¼‰
- âš ï¸ å¤æ‚ä¸šåŠ¡é€»è¾‘éœ€æ‰‹åŠ¨è¡¥å……æµ‹è¯•
- âŒ ä¸èƒ½å®Œå…¨æ›¿ä»£æ‰‹å·¥ç¼–å†™æµ‹è¯•

---

## ç›¸å…³èµ„æº

- **è¯¦ç»†ä½¿ç”¨æŒ‡å—**: [README.md](./README.md)
- **ç¤ºä¾‹ä»£ç **: [examples/](./examples/)
- **é¡¹ç›®æµ‹è¯•ç­–ç•¥**: [../../CLAUDE.md](../../CLAUDE.md)
- **testify æ–‡æ¡£**: https://github.com/stretchr/testify

---

*Skill ç‰ˆæœ¬: 1.0.0*
*åˆ›å»ºæ—¶é—´: 2026-02-04*
*é€‚ç”¨äº: onebot-go-sdk é¡¹ç›®*
