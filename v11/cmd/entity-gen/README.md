# entity-gen å®ä½“ä»£ç ç”Ÿæˆå·¥å…·

## æ¦‚è¿°

**entity-gen** æ˜¯ä¸€ä¸ªç”¨äº Go è¯­è¨€çš„ä»£ç ç”Ÿæˆå·¥å…·ï¼Œä¸“é—¨ç”¨äºä¸ºç»“æ„ä½“è‡ªåŠ¨ç”Ÿæˆ **Getter** å’Œ **Setter** æ–¹æ³•ã€‚

### æ ¸å¿ƒç‰¹æ€§

- **è‡ªåŠ¨ä»£ç ç”Ÿæˆ**ï¼šåŸºäº AST åˆ†æè‡ªåŠ¨ç”Ÿæˆæ ·æ¿ä»£ç 
- **æ™ºèƒ½ç±»å‹å¤„ç†**ï¼šåŒºåˆ†åŸºæœ¬ç±»å‹å’Œå¤æ‚ç±»å‹ï¼Œé‡‡ç”¨ä¸åŒçš„å¤„ç†ç­–ç•¥
- **ç±»å‹åˆ«åè¯†åˆ«**ï¼šè‡ªåŠ¨æ‰«æå’Œè¯†åˆ«è‡ªå®šä¹‰ç±»å‹åˆ«åï¼ˆå¦‚ `type MyString string`ï¼‰
- **æ³¨é‡Šä¿ç•™**ï¼šç”Ÿæˆçš„æ–¹æ³•ä¼šä¿ç•™åŸå­—æ®µçš„æ³¨é‡Šæ–‡æ¡£
- **ç©ºæŒ‡é’ˆå®‰å…¨**ï¼šæ‰€æœ‰ Getter æ–¹æ³•éƒ½åŒ…å«ç©ºæŒ‡é’ˆæ£€æŸ¥
- **é“¾å¼è°ƒç”¨**ï¼šæ‰€æœ‰ Setter æ–¹æ³•éƒ½è¿”å›æ¥æ”¶è€…æŒ‡é’ˆï¼Œæ”¯æŒé“¾å¼è°ƒç”¨

---

## ğŸš€ ä½¿ç”¨æ–¹æ³•

### 1. å‘½ä»¤è¡Œç›´æ¥è°ƒç”¨

```bash
# ä¸ºæŒ‡å®šæ–‡ä»¶ä¸­çš„æ‰€æœ‰ç»“æ„ä½“ç”Ÿæˆæ–¹æ³•
entity-gen -file=model.go

# ä»…ä¸ºç‰¹å®šç±»å‹ç”Ÿæˆæ–¹æ³•
entity-gen -file=model.go -type=User

# ä¸ºå¤šä¸ªç±»å‹ç”Ÿæˆæ–¹æ³•ï¼ˆé€—å·åˆ†éš”ï¼‰
entity-gen -file=model.go -type=User,Product,Order

# è‡ªå®šä¹‰è¾“å‡ºæ–‡ä»¶å
entity-gen -file=model.go -output=custom_output.go

# æ‰‹åŠ¨æŒ‡å®šé¢å¤–çš„å¸¸é‡æ–‡ä»¶æ‰«æ
entity-gen -file=model.go -consts=types_consts.go,status_consts.go

# ç¦ç”¨è‡ªåŠ¨æ‰«æ *_consts.go æ–‡ä»¶
entity-gen -file=model.go -no-auto-scan
```

### 2. é…åˆ go generate ä½¿ç”¨ï¼ˆæ¨èæ–¹å¼ï¼‰

åœ¨ä½ çš„ Go æºæ–‡ä»¶ä¸­æ·»åŠ  `//go:generate` æ³¨é‡Šï¼š

```go
package model

//go:generate entity-gen -type=User
type User struct {
	ID       int64
	Username string
	Email    *string
	Age      *int
}

//go:generate entity-gen -type=Product,Order
type Product struct {
	// ... å­—æ®µå®šä¹‰
}

type Order struct {
	// ... å­—æ®µå®šä¹‰
}
```

ç„¶åè¿è¡Œï¼š

```bash
go generate ./...
```

### å‘½ä»¤è¡Œå‚æ•°è¯¦è§£

| å‚æ•°              | è¯´æ˜                   | é»˜è®¤å€¼                           | ç¤ºä¾‹                     |
|-----------------|----------------------|-------------------------------|------------------------|
| `-file`         | è¦å¤„ç†çš„ Go æºæ–‡ä»¶          | `$GOFILE` ç¯å¢ƒå˜é‡                | `-file=model.go`       |
| `-type`         | è¦å¤„ç†çš„ç»“æ„ä½“ç±»å‹åï¼ˆå¯é€‰ï¼Œé€—å·åˆ†éš”ï¼‰  | ç©ºï¼ˆå¤„ç†æ‰€æœ‰ï¼‰                       | `-type=User,Product`   |
| `-output`       | è¾“å‡ºæ–‡ä»¶è·¯å¾„               | `{filename}_setter_getter.go` | `-output=generated.go` |
| `-consts`       | é¢å¤–çš„å¸¸é‡æ–‡ä»¶ï¼ˆé€—å·åˆ†éš”ï¼‰        | ç©º                             | `-consts=types.go`     |
| `-no-auto-scan` | ç¦ç”¨è‡ªåŠ¨æ‰«æ `*_consts.go` | `false`                       | `-no-auto-scan`        |

---

## ğŸ“– ç”Ÿæˆä»£ç ç¤ºä¾‹

### è¾“å…¥ä»£ç 

```go
package model

type Status string

type User struct {
	// ç”¨æˆ·ID
	ID int64
	// ç”¨æˆ·å
	Username string
	// ç”¨æˆ·é‚®ç®±ï¼ˆå¯é€‰ï¼‰
	Email *string
	// ç”¨æˆ·å¹´é¾„
	Age *int
	// ç”¨æˆ·çŠ¶æ€
	Status Status
}
```

### ç”Ÿæˆçš„ä»£ç  (model_setter_getter.go)

```go
// Code generated by entity-gen. DO NOT EDIT.

package model

// GetID
// ç”¨æˆ·ID
func (r *User) GetID() int64 {
	if r == nil {
		var zero int64
		return zero
	}
	return r.ID
}

// SetID
// ç”¨æˆ·ID
func (r *User) SetID(v int64) *User {
	r.ID = v
	return r
}

// GetUsername
// ç”¨æˆ·å
func (r *User) GetUsername() string {
	if r == nil {
		var zero string
		return zero
	}
	return r.Username
}

// SetUsername
// ç”¨æˆ·å
func (r *User) SetUsername(v string) *User {
	r.Username = v
	return r
}

// GetEmail
// ç”¨æˆ·é‚®ç®±ï¼ˆå¯é€‰ï¼‰
func (r *User) GetEmail() string {
	if r == nil {
		var zero string
		return zero
	}
	if r.Email == nil {
		var zero string
		return zero
	}
	return *r.Email
}

// SetEmail
// ç”¨æˆ·é‚®ç®±ï¼ˆå¯é€‰ï¼‰
func (r *User) SetEmail(v string) *User {
	val := v
	r.Email = &val
	return r
}

// GetAge
// ç”¨æˆ·å¹´é¾„
func (r *User) GetAge() int {
	if r == nil {
		var zero int
		return zero
	}
	if r.Age == nil {
		var zero int
		return zero
	}
	return *r.Age
}

// SetAge
// ç”¨æˆ·å¹´é¾„
func (r *User) SetAge(v int) *User {
	val := v
	r.Age = &val
	return r
}

// GetStatus
// ç”¨æˆ·çŠ¶æ€
func (r *User) GetStatus() Status {
	if r == nil {
		var zero Status
		return zero
	}
	return r.Status
}

// SetStatus
// ç”¨æˆ·çŠ¶æ€
func (r *User) SetStatus(v Status) *User {
	r.Status = v
	return r
}
```

### ä½¿ç”¨é“¾å¼è°ƒç”¨

```go
user := &User{}
user.SetID(1001).
SetUsername("alice").
SetEmail("alice@example.com").
SetAge(25).
SetStatus("active")

// å®‰å…¨çš„ Getter è°ƒç”¨
email := user.GetEmail() // å³ä½¿ Email æ˜¯ nil ä¹Ÿä¼šè¿”å›é›¶å€¼
```

---

## ğŸ—ï¸ å®ç°åŸç†

### æ¶æ„è®¾è®¡

å·¥å…·é‡‡ç”¨ç»å…¸çš„**ç”Ÿæˆå™¨æ¨¡å¼**ï¼Œä¸»è¦åŒ…å«ä¸¤ä¸ªæ ¸å¿ƒç»„ä»¶ï¼š

```
main.go         - å‘½ä»¤è¡Œå‚æ•°è§£æå’Œæµç¨‹æ§åˆ¶
generator.go    - AST åˆ†æå’Œä»£ç ç”Ÿæˆé€»è¾‘
```

### æ ¸å¿ƒå¤„ç†æµç¨‹

```
1. æ–‡ä»¶è§£æé˜¶æ®µ
   â”œâ”€ è¯»å–æºæ–‡ä»¶å’ŒæŒ‡å®šçš„å¸¸é‡æ–‡ä»¶
   â”œâ”€ ä½¿ç”¨ go/parser æ„å»º AST
   â””â”€ æ‰«æå¹¶ç¼“å­˜è‡ªå®šä¹‰ç±»å‹åˆ«å

2. ç»“æ„ä½“å‘ç°é˜¶æ®µ
   â”œâ”€ éå† AST å¯»æ‰¾ç›®æ ‡ç»“æ„ä½“å®šä¹‰
   â”œâ”€ å¦‚æœæŒ‡å®šäº† -type å‚æ•°ï¼Œä»…å¤„ç†åŒ¹é…çš„ç±»å‹
   â””â”€ æå–ç»“æ„ä½“çš„æ‰€æœ‰å¯¼å‡ºå­—æ®µ

3. å­—æ®µåˆ†æé˜¶æ®µ
   â”œâ”€ åˆ¤æ–­å­—æ®µæ˜¯å¦ä¸ºæŒ‡é’ˆç±»å‹
   â”œâ”€ åˆ¤æ–­å­—æ®µæ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹/è‡ªå®šä¹‰ç±»å‹åˆ«å
   â”œâ”€ æå–å­—æ®µçš„æ³¨é‡Šæ–‡æ¡£
   â””â”€ è®°å½•å­—æ®µçš„æ¥æ”¶è€…ç±»å‹

4. ä»£ç ç”Ÿæˆé˜¶æ®µ
   â”œâ”€ ä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆ Getter æ–¹æ³•
   â”œâ”€ ä¸ºæ¯ä¸ªå­—æ®µç”Ÿæˆ Setter æ–¹æ³•
   â”œâ”€ åº”ç”¨ä¸åŒçš„ç”Ÿæˆç­–ç•¥ï¼ˆåŸºæœ¬ç±»å‹ vs å¤æ‚ç±»å‹ï¼‰
   â””â”€ ä½¿ç”¨ go/format æ ¼å¼åŒ–è¾“å‡º

5. æ–‡ä»¶å†™å…¥é˜¶æ®µ
   â””â”€ å°†ç”Ÿæˆçš„ä»£ç å†™å…¥è¾“å‡ºæ–‡ä»¶
```

### å…³é”®å®ç°ç»†èŠ‚

#### 1. ç±»å‹è¯†åˆ«æœºåˆ¶

```go
type fieldInfo struct {
name         string // å­—æ®µå
typeName     string // ç±»å‹åç§°
isPointer    bool   // æ˜¯å¦ä¸ºæŒ‡é’ˆ
isBasic      bool   // æ˜¯å¦ä¸ºåŸºæœ¬ç±»å‹
comments     string // æ³¨é‡Šå†…å®¹
receiverType string // æ¥æ”¶è€…ç±»å‹
}
```

**åŸºæœ¬ç±»å‹åˆ¤æ–­é€»è¾‘**ï¼š

- Go å†…ç½®åŸºæœ¬ç±»å‹ï¼ˆint, string, bool ç­‰ï¼‰â†’ `basicTypesCache`
- è‡ªå®šä¹‰ç±»å‹åˆ«åï¼ˆå¦‚ `type Status string`ï¼‰â†’ `customTypeAliases`

#### 2. æŒ‡é’ˆå¤„ç†ç­–ç•¥

| åŸå­—æ®µç±»å‹            | Getter è¿”å›ç±»å‹ | Setter å‚æ•°ç±»å‹ | å¤„ç†é€»è¾‘                  |
|------------------|-------------|-------------|-----------------------|
| åŸºæœ¬ç±»å‹             | éæŒ‡é’ˆ         | éæŒ‡é’ˆ         | ç›´æ¥èµ‹å€¼                  |
| åŸºæœ¬ç±»å‹æŒ‡é’ˆ (`*int`)  | éæŒ‡é’ˆ         | éæŒ‡é’ˆ         | Getter è§£å¼•ç”¨ï¼ŒSetter å–åœ°å€ |
| å¤æ‚ç±»å‹             | éæŒ‡é’ˆ         | éæŒ‡é’ˆ         | ç›´æ¥èµ‹å€¼                  |
| å¤æ‚ç±»å‹æŒ‡é’ˆ (`*User`) | æŒ‡é’ˆ          | æŒ‡é’ˆ          | ç›´æ¥èµ‹å€¼                  |

**è®¾è®¡ç†å¿µ**ï¼š

- **å¯¹å¤– API ç®€åŒ–**ï¼šåŸºæœ¬ç±»å‹çš„æŒ‡é’ˆå­—æ®µå¯¹å¤–æš´éœ²ä¸ºéæŒ‡é’ˆæ¥å£
- **å†…éƒ¨ç»†èŠ‚å°è£…**ï¼šè‡ªåŠ¨å¤„ç†æŒ‡é’ˆçš„è§£å¼•ç”¨å’Œå–åœ°å€æ“ä½œ
- **ä¿ç•™å¤æ‚ç±»å‹æŒ‡é’ˆ**ï¼šé¿å…ä¸å¿…è¦çš„å€¼æ‹·è´å¼€é”€

#### 3. ç©ºæŒ‡é’ˆå®‰å…¨æœºåˆ¶

æ‰€æœ‰ Getter æ–¹æ³•éƒ½åŒ…å«ä¸¤å±‚é˜²æŠ¤ï¼š

```go
func (r *User) GetEmail() string {
// ç¬¬ä¸€å±‚ï¼šæ£€æŸ¥æ¥æ”¶è€…æ˜¯å¦ä¸º nil
if r == nil {
var zero string
return zero
}
// ç¬¬äºŒå±‚ï¼šæ£€æŸ¥å­—æ®µæ˜¯å¦ä¸º nilï¼ˆä»…é’ˆå¯¹æŒ‡é’ˆå­—æ®µï¼‰
if r.Email == nil {
var zero string
return zero
}
return *r.Email // å®‰å…¨è§£å¼•ç”¨
}
```

#### 4. è‡ªå®šä¹‰ç±»å‹åˆ«åæ‰«æ

å·¥å…·ä¼šè‡ªåŠ¨æ‰«æä»¥ä¸‹æ¥æºçš„ç±»å‹åˆ«åå®šä¹‰ï¼š

1. **ä¸»æ–‡ä»¶**ï¼šå½“å‰æ­£åœ¨å¤„ç†çš„ Go æºæ–‡ä»¶
2. **åŒç›®å½• `*_consts.go` æ–‡ä»¶**ï¼šè‡ªåŠ¨å‘ç°ï¼ˆé™¤éä½¿ç”¨ `-no-auto-scan`ï¼‰
3. **æ‰‹åŠ¨æŒ‡å®šæ–‡ä»¶**ï¼šé€šè¿‡ `-consts` å‚æ•°æŒ‡å®š

æ‰«æé€»è¾‘ï¼ˆå‚è§ `generator.go:426-453`ï¼‰ï¼š

```go
// è¯†åˆ«å½¢å¦‚ type MyString string çš„å®šä¹‰
func (g *Generator) collectTypeAliasesFromAST(file *ast.File) {
for _, decl := range file.Decls {
// éå†æ‰€æœ‰ç±»å‹å£°æ˜
// å¦‚æœåŸºç¡€ç±»å‹æ˜¯ Go å†…ç½®ç±»å‹
// åˆ™å°†åˆ«åè®°å½•åˆ° customTypeAliases
}
}
```

#### 5. æ³¨é‡Šç»§æ‰¿æœºåˆ¶

ç”Ÿæˆçš„æ–¹æ³•ä¼šä¿ç•™åŸå­—æ®µçš„æ³¨é‡Šï¼ˆå‚è§ `generator.go:348-379`ï¼‰ï¼š

- ä¼˜å…ˆä½¿ç”¨å­—æ®µçš„ **Doc æ³¨é‡Š**ï¼ˆå­—æ®µä¸Šæ–¹çš„æ³¨é‡Šå—ï¼‰
- å…¶æ¬¡ä½¿ç”¨ **è¡Œå°¾æ³¨é‡Š**
- æ”¯æŒå¤šè¡Œæ³¨é‡Šçš„æ­£ç¡®å¤„ç†
